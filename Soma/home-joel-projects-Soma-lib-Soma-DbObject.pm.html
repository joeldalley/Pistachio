<div>
<div style="font-family:Consolas,'Liberation Mono',Courier,monospace;float:left;background-color:#eee;border-right:1px #999988 solid">
<div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">1</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">2</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">3</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">4</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">5</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">6</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">7</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">8</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">9</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">10</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">11</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">12</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">13</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">14</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">15</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">16</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">17</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">18</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">19</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">20</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">21</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">22</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">23</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">24</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">25</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">26</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">27</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">28</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">29</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">30</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">31</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">32</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">33</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">34</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">35</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">36</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">37</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">38</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">39</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">40</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">41</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">42</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">43</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">44</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">45</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">46</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">47</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">48</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">49</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">50</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">51</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">52</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">53</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">54</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">55</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">56</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">57</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">58</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">59</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">60</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">61</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">62</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">63</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">64</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">65</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">66</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">67</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">68</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">69</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">70</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">71</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">72</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">73</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">74</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">75</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">76</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">77</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">78</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">79</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">80</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">81</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">82</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">83</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">84</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">85</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">86</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">87</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">88</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">89</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">90</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">91</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">92</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">93</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">94</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">95</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">96</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">97</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">98</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">99</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">100</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">101</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">102</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">103</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">104</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">105</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">106</div> <div style="font-size:13px;color:#999988;display:block;line-height:18px;padding:0 8px;margin:0;border:0;text-align:right;border-spacing:2px">107</div>
</div>

<div style="font-family:Consolas,'Liberation Mono',Courier,monospace;padding:0 8px 0 11px;white-space:pre;font-size:13px;line-height:18px;float:left"><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ A Soma::DbObject represents a row from a database table.
</span><span style="color:#999988;font-style:italic">#/ It must have a primary key column called &#39;id&#39; to work correctly.
</span><span style="color:#999988;font-style:italic">#/
</span><span style="color:#999988;font-style:italic">#/ @author Joel Dalley
</span><span style="color:#999988;font-style:italic">#/ @version 2013/Mar/23
</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">use</span><span style="color:#FFF"> </span><span style="color:#333">stern</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#0086B3">package</span><span style="color:#FFF"> </span><span style="color:#333">Soma::DbObject</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">use</span><span style="color:#FFF"> </span><span style="color:#333">Soma::Db</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">use</span><span style="color:#FFF"> </span><span style="color:#333">Soma::DbObject::DbData</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">TABLE</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#008080">0</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">DATA</span><span style="color:#FFF">  </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#008080">1</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">PK</span><span style="color:#FFF">    </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#D14">&#39;id&#39;</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#//////////////////////////////////////////////////////////////
</span><span style="color:#999988;font-style:italic">#/ Object interface ///////////////////////////////////////////
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param string $type    object type
</span><span style="color:#999988;font-style:italic">#/ @param string $table    database table
</span><span style="color:#999988;font-style:italic">#/ @param string $cols    table columns
</span><span style="color:#999988;font-style:italic">#/ @param arrayref $vals    column values
</span><span style="color:#999988;font-style:italic">#/ @return object    a Soma::DbObject 
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">new</span><span style="color:#333">($$$$)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#008080">$type</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$table</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$vals</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#008080">@_</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">$data</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#333">_newData</span><span style="color:#333">(</span><span style="color:#008080">$cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$vals</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#0086B3">bless</span><span style="color:#FFF"> </span><span style="color:#333">[</span><span style="color:#008080">$table</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$data</span><span style="color:#333">]</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$type</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object    a Soma::DbObject
</span><span style="color:#999988;font-style:italic">#/ @return mixed    object&#39;s id
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">id</span><span style="color:#333">($)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#333">datum</span><span style="color:#333">(</span><span style="color:#0086B3">shift</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333">PK</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object $this    a Soma::DbObject
</span><span style="color:#999988;font-style:italic">#/ @param string $field    data field name
</span><span style="color:#999988;font-style:italic">#/ @param mixed [optional] $value    data field value (to set)
</span><span style="color:#999988;font-style:italic">#/ @return mixed    data field value
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">datum</span><span style="color:#333">($$;$)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF"> 
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$field</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$value</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#008080">@_</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#008080">$this</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">[</span><span style="color:#0086B3">DATA</span><span style="color:#333">]</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">(</span><span style="color:#008080">$field</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$value</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ Same as datum(), except PK field is read-only
</span><span style="color:#999988;font-style:italic">#/ @see datum();
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">datumReadOnlyPK</span><span style="color:#333">(@)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$field</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$value</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#008080">@_</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#008080">$value</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#0086B3">undef</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">if</span><span style="color:#FFF"> </span><span style="color:#008080">$field</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">eq</span><span style="color:#FFF"> </span><span style="color:#333">PK</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333">datum</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$field</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$value</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object $this    a Soma::DbObject
</span><span style="color:#999988;font-style:italic">#/ @param coderef $gen    id generating subroutine
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">save</span><span style="color:#333">($&amp;)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$gen</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#008080">@_</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">$id</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#333">id</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">
    </span><span style="color:#333;font-weight:bold">if</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#333">!</span><span style="color:#008080">$id</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#0086B3">die</span><span style="color:#FFF"> </span><span style="color:#D14">&quot;Invalid id generator&quot;</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">if</span><span style="color:#FFF"> </span><span style="color:#333">!</span><span style="color:#0086B3">ref</span><span style="color:#FFF"> </span><span style="color:#008080">$gen</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">eq</span><span style="color:#FFF"> </span><span style="color:#D14">&#39;CODE&#39;</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#333">datum</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333">PK</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$gen</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">(</span><span style="color:#333">)</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">
        </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">@cols</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#333">_cols</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">@vals</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#0086B3">map</span><span style="color:#FFF"> </span><span style="color:#333">datum</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$_</span><span style="color:#333">)</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">@cols</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#333">Db::insert</span><span style="color:#333">(</span><span style="color:#333">_table</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">\</span><span style="color:#008080">@cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">\</span><span style="color:#008080">@vals</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">else</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">        #/ columns &amp; values for updating;
</span><span style="color:#999988;font-style:italic">        #/ exclude primary key id column
</span><span style="color:#FFF">        </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">@cols</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#0086B3">grep</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#008080">$_</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">ne</span><span style="color:#FFF"> </span><span style="color:#333">PK</span><span style="color:#333">}</span><span style="color:#FFF"> </span><span style="color:#333">_cols</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">@vals</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#0086B3">map</span><span style="color:#FFF"> </span><span style="color:#333">datum</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$_</span><span style="color:#333">)</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">@cols</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">
        </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">@clauses</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#333">PK</span><span style="color:#333">.</span><span style="color:#D14">&#39;=?&#39;</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#0086B3">push</span><span style="color:#FFF"> </span><span style="color:#008080">@vals</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333">id</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">        </span><span style="color:#333">Db::update</span><span style="color:#333">(</span><span style="color:#333">_table</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">\</span><span style="color:#008080">@cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">\</span><span style="color:#008080">@clauses</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333;font-weight:bold">\</span><span style="color:#008080">@vals</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object $this    a Soma::DbObject
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">delete</span><span style="color:#333">($)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#008080">$this</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#0086B3">shift</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333">Db::delete</span><span style="color:#333">(</span><span style="color:#333">_table</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333">[</span><span style="color:#333">PK</span><span style="color:#333">.</span><span style="color:#D14">&#39;=?&#39;</span><span style="color:#333">]</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#333">[</span><span style="color:#333">id</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">]</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#008080">$this</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">[</span><span style="color:#0086B3">DATA</span><span style="color:#333">]</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#333">_newData</span><span style="color:#333">(</span><span style="color:#333">[</span><span style="color:#333">_cols</span><span style="color:#333">(</span><span style="color:#008080">$this</span><span style="color:#333">)</span><span style="color:#333">]</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#//////////////////////////////////////////////////////////////
</span><span style="color:#999988;font-style:italic">#/ Internal use ///////////////////////////////////////////////
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object    a Soma::DbObject
</span><span style="color:#999988;font-style:italic">#/ @return string    object&#39;s database table
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">_table</span><span style="color:#333">($)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#0086B3">shift</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">[</span><span style="color:#333">TABLE</span><span style="color:#333">]</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param object    a Soma::DbObject
</span><span style="color:#999988;font-style:italic">#/ @return array    object&#39;s database columns
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">_cols</span><span style="color:#333">($)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF"> </span><span style="color:#0086B3">shift</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">[</span><span style="color:#0086B3">DATA</span><span style="color:#333">]</span><span style="color:#333;font-weight:bold">-&gt;</span><span style="color:#333">(</span><span style="color:#D14">&#39;cols&#39;</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#999988;font-style:italic">#/ @param arrayref $cols    table columns
</span><span style="color:#999988;font-style:italic">#/ @param arrayref [optional] $values    column values
</span><span style="color:#999988;font-style:italic">#/ @return object    a Soma::DbObject::DbData
</span><span style="color:#333;font-weight:bold">sub</span><span style="color:#FFF"> </span><span style="color:#990000;font-weight:bold">_newData</span><span style="color:#333">($;$)</span><span style="color:#FFF"> </span><span style="color:#333">{</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333;font-weight:bold">my</span><span style="color:#FFF"> </span><span style="color:#333">(</span><span style="color:#008080">$cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$vals</span><span style="color:#333">)</span><span style="color:#FFF"> </span><span style="color:#333">=</span><span style="color:#FFF"> </span><span style="color:#008080">@_</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#FFF">    </span><span style="color:#333">Soma::DbObject::DbData::new</span><span style="color:#333">(</span><span style="color:#008080">$cols</span><span style="color:#333">,</span><span style="color:#FFF"> </span><span style="color:#008080">$vals</span><span style="color:#333">)</span><span style="color:#333">;</span><span style="color:#FFF">
</span><span style="color:#333">}</span><span style="color:#FFF">
</span><span style="color:#FFF">
</span><span style="color:#008080">1</span><span style="color:#333">;</span><span style="color:#FFF">
</span></div>
</div>
<div style="clear:both"></div>